@model _24DH113309_MyStore.Models.ViewModels.ProductSearchVM
@using PagedList.Mvc;

@{
    ViewBag.Title = "Danh sách sản phẩm";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<style>
    table {
        border-collapse: separate;
        border-spacing: 0;
        border-radius: 10px;
        overflow: hidden;
        width: 100%;
        background-color: #ffffff;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
    }

    thead th {
        background-color: #00c8f0;
        color: white;
        font-weight: 600;
        text-align: center;
        padding: 10px;
        font-size: 15px;
    }

    tbody td {
        vertical-align: middle;
        text-align: center;
        padding: 12px;
        border-top: 1px solid #eee;
        color: #333;
        font-size: 15px;
    }

        tbody td img {
            height: 110px;
            width: auto;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s ease-in-out;
        }

            tbody td img:hover {
                transform: scale(1.05);
            }

    tbody tr:hover {
        background-color: #f5faff;
        transition: 0.2s;
    }

    .action-buttons {
        white-space: nowrap;
        text-align: left;
        width: 260px;
    }

        .action-buttons .btn {
            min-width: 70px;
            margin: 2px;
            font-weight: 500;
            border-radius: 6px;
            transition: 0.2s;
        }

    .pagination-wrapper {
        margin-top: 20px;
    }

    .pagination {
        display: inline-flex;
        justify-content: center;
        padding: 0;
    }

        .pagination li {
            list-style: none;
            margin: 0 4px;
        }

            .pagination li a,
            .pagination li span {
                display: block;
                padding: 8px 12px;
                color: #007bff;
                background: #fff;
                border: 1px solid #ddd;
                border-radius: 5px;
                text-decoration: none;
                font-weight: 500;
            }

            .pagination li.active span {
                background-color: #00c8f0;
                color: #fff;
                border-color: #00c8f0;
            }

            .pagination li a:hover {
                background-color: #e6f5ff;
            }


    .sort-link {
        color: #007bff;
        text-decoration: none;
        margin: 0 8px;
        font-weight: 500;
    }

        .sort-link.active {
            color: #00a0ff;
            font-weight: 700;
            text-decoration: underline;
        }

    .search-bar {
        justify-content: center;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
        margin-bottom: 15px;
    }

        .search-bar input {
            height: 38px;
        }
</style>

<!-- 🔍 FORM TÌM KIẾM -->
<form method="get" class="search-bar mb-3">
    <input type="text" name="searchTerm" placeholder="Tìm sản phẩm..." value="@Model.SearchTerm" class="form-control" />
    <input type="number" name="minPrice" placeholder="Giá từ" value="@Model.MinPrice" class="form-control" />
    <input type="number" name="maxPrice" placeholder="Đến" value="@Model.MaxPrice" class="form-control" />
    <button type="submit" class="btn btn-primary">Tìm kiếm</button>
</form>

<!-- 🏷️ TIÊU ĐỀ -->
<h2 class="text-center text-primary mb-3">DANH SÁCH SẢN PHẨM</h2>

<!-- 🧭 SẮP XẾP -->
<div class="text-center mb-4" style="font-size:16px; font-weight:500;">
    <span class="text-secondary me-2">Sắp xếp theo:</span>
    @Html.ActionLink("Tên tăng dần", "Index", new { sortOrder = "name_asc", searchTerm = Model.SearchTerm, minPrice = Model.MinPrice, maxPrice = Model.MaxPrice },
                        new { @class = ViewBag.SortOrder == "name_asc" ? "sort-link active" : "sort-link" })
    |
    @Html.ActionLink("Tên tăng dần", "Index", new { sortOrder = "name_desc", searchTerm = Model.SearchTerm, minPrice = Model.MinPrice, maxPrice = Model.MaxPrice },
                        new { @class = ViewBag.SortOrder == "name_desc" ? "sort-link active" : "sort-link" })
    |
    @Html.ActionLink("Giá giảm dần ", "Index", new { sortOrder = "price_asc", searchTerm = Model.SearchTerm, minPrice = Model.MinPrice, maxPrice = Model.MaxPrice },
                        new { @class = ViewBag.SortOrder == "price_asc" ? "sort-link active" : "sort-link" })
    |
    @Html.ActionLink("Giá tăng dần", "Index", new { sortOrder = "price_desc", searchTerm = Model.SearchTerm, minPrice = Model.MinPrice, maxPrice = Model.MaxPrice },
                        new { @class = ViewBag.SortOrder == "price_desc" ? "sort-link active" : "sort-link" })
</div>

<!-- 📋 DANH SÁCH SẢN PHẨM -->
<table class="table table-bordered text-center">
    <thead class="bg-info text-white">
        <tr>
            <th>Hình ảnh</th>
            <th>Tên sản phẩm</th>
            <th>Giá</th>
            <th>Danh mục</th>
            <th>Thao tác</th>
        </tr>
    </thead>
    <tbody>
        @if (Model.Results != null && Model.Results.Count > 0)
        {
            foreach (var item in Model.Results)
            {
                <tr>
                    <td><img src="@item.ProductImage" /></td>
                    <td>@item.ProductName</td>
                    <td>@String.Format("{0:N0} VNĐ", item.ProductPrice)</td>
                    <td>@item.Category.CategoryName</td>
                    <td class="action-buttons">
                        @Html.ActionLink("Sửa", "Edit", new { id = item.ProductID }, new { @class = "btn btn-warning btn-sm" })
                        @Html.ActionLink("Chi tiết", "Details", new { id = item.ProductID }, new { @class = "btn btn-info btn-sm" })
                        @Html.ActionLink("Xóa", "Delete", new { id = item.ProductID }, new { @class = "btn btn-danger btn-sm" })
                    </td>
                </tr>
            }
        }
        else
        {
            <tr><td colspan="5" class="text-muted text-center">Không tìm thấy sản phẩm nào</td></tr>
        }
    </tbody>
</table>

<!-- ➕ NÚT THÊM MỚI -->
<div class="text-left">
    @Html.ActionLink(" Thêm mới ", "Create", null, new { @class = "btn btn-success mt-2" })
</div>

<!-- 📄 PHÂN TRANG -->
@if (Model.Results != null && Model.Results.Any())
{
    <div class="pagination-wrapper text-center mt-3">
        @Html.PagedListPager(
                 Model.Results,
                 page => Url.Action("Index", new
                 {
                     page,
                     searchTerm = Model.SearchTerm,
                     minPrice = Model.MinPrice,
                     maxPrice = Model.MaxPrice,
                     sortOrder = ViewBag.SortOrder
                 }),
                 new PagedListRenderOptions
                 {
                     Display = PagedListDisplayMode.IfNeeded,
                     UlElementClasses = new[] { "pagination" },
                     LiElementClasses = new[] { "page-item" },
                     LinkToPreviousPageFormat = "«",
                     LinkToNextPageFormat = "»",
                     MaximumPageNumbersToDisplay = 5,
                     ContainerDivClasses = new[] { "text-center" }
                 }
             )
    </div>
}
