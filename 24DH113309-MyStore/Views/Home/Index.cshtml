@model PagedList.IPagedList<_24DH113309_MyStore.Models.Product>
@using PagedList.Mvc;
@using System.Collections.Specialized
@{
    Layout = "~/Views/Shared/_CustomerLayout.cshtml";
    ViewBag.Title = "Trang chủ";
}

<style>
    /* Biến màu chính */
    :root {
        --tiki-primary: #0d5cb6;
        --tiki-light-bg: #f5f5fa;
        --tiki-red: #ff3d3d;
        --tiki-text-primary: #333;
        --tiki-text-secondary: #777;
    }

    body {
        background-color: var(--tiki-light-bg) !important;
    }

    /* Tiêu đề cho mỗi khu vực */
    .section-title {
        font-size: 22px;
        font-weight: 600;
        color: var(--tiki-text-primary);
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
    }

    /* Khung chứa chung cho các khu vực */
    .section-container {
        background-color: #ffffff;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 25px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    /* ⭐ CSS CHO THANH TÌM KIẾM (BẢN FIX FULL) ⭐ */
    .search-bar-container {
        padding: 25px 0;
        margin: 0 auto 30px auto;
        max-width: 900px;
    }

    .search-bar {
        display: flex;
        width: 100%; /* ép full width */
        align-items: center;
        background: #fff;
        border-radius: 14px;
        padding: 6px;
        border: 1px solid #e5e7eb;
        box-shadow: 0 4px 16px rgba(0,0,0,0.05);
    }

        /* INPUT TỰ GIÃN FULL CHIỀU NGANG */
        .search-bar input {
            flex: 1;
            border: none;
            font-size: 16px;
            padding: 14px 10px;
            background: transparent;
            outline: none;
        }

    /* BUTTON SÁT MÉP PHẢI */
    .search-btn {
        margin-left: auto; /* ⬅ NẰM CỐT LÕI – ĐẨY NÚT SÁT BÊN PHẢI */
        background: var(--tiki-primary);
        border: none;
        padding: 12px 28px;
        color: white;
        font-weight: 600;
        border-radius: 10px;
    }


    /* 1. KHU VỰC DANH MỤC */
    .category-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 15px;
    }

    .category-item-tiki {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-decoration: none;
        color: var(--tiki-text-primary);
        padding: 10px;
        border-radius: 8px;
        transition: all 0.2s ease-in-out;
    }

        .category-item-tiki:hover {
            background-color: var(--tiki-light-bg);
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
        }

        .category-item-tiki.active {
            background-color: #e6f0ff;
            border: 1px solid var(--tiki-primary);
        }

        .category-item-tiki img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            margin-bottom: 8px;
        }

        .category-item-tiki span {
            font-size: 14px;
            font-weight: 500;
            text-align: center;
        }

    /* 2. KHU VỰC SẢN PHẨM */
    .product-card-tiki {
        background-color: #fff;
        border: 1px solid #eee;
        border-radius: 10px;
        text-decoration: none;
        color: var(--tiki-text-primary);
        transition: all 0.2s ease-in-out;
        display: block;
        margin-bottom: 15px;
        position: relative;
        overflow: hidden;
    }

        .product-card-tiki:hover {
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            transform: translateY(-5px);
        }

        .product-card-tiki .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .product-card-tiki .product-info {
            padding: 12px;
        }

        .product-card-tiki .product-name {
            font-size: 15px;
            font-weight: 500;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            height: 45px;
            margin-bottom: 5px;
        }

        .product-card-tiki .product-price {
            font-size: 18px;
            font-weight: 600;
            color: var(--tiki-red);
        }

        .product-card-tiki .product-price-old {
            font-size: 13px;
            text-decoration: line-through;
            color: var(--tiki-text-secondary);
            margin-left: 5px;
        }

        .product-card-tiki .product-tag {
            position: absolute;
            top: 10px;
            left: -1px;
            background-color: var(--tiki-red);
            color: white;
            padding: 4px 10px 4px 8px;
            font-weight: 600;
            font-size: 12px;
            border-top-right-radius: 4px;
            border-bottom-right-radius: 4px;
        }

        .product-card-tiki .product-tag-best {
            background-color: #ffc107;
            color: #333;
        }

    /* 3. PHÂN TRANG */
    .pagination-container {
        display: flex;
        justify-content: center;
        margin-top: 30px;
    }

    .pagination > .page-item > a,
    .pagination > .page-item > span {
        color: var(--tiki-primary) !important;
        border-radius: 6px !important;
        margin: 0 4px;
        padding: 8px 14px;
        font-weight: 500;
    }

    .pagination > .active > a,
    .pagination > .active > span,
    .pagination > .active > a:hover,
    .pagination > .active > span:hover {
        background-color: var(--tiki-primary) !important;
        border-color: var(--tiki-primary) !important;
        color: white !important;
    }
</style>


<div id="bannerCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
    <div class="carousel-indicators">
        <button type="button" data-bs-target="#bannerCarousel" data-bs-slide-to="0" class="active"></button>
        <button type="button" data-bs-target="#bannerCarousel" data-bs-slide-to="1"></button>
        <button type="button" data-bs-target="#bannerCarousel" data-bs-slide-to="2"></button>
    </div>
    <div class="carousel-inner" style="border-radius: 12px;">

        <div class="carousel-item active">
            <img src="https://i.ytimg.com/vi/AD23iTj37v0/maxresdefault.jpg" class="d-block w-100" style="height:420px;object-fit:cover;" />
            <div class="carousel-caption d-none d-md-block" style="background: rgba(0, 0, 0, 0.4); border-radius: 10px; padding: 15px;">
                <h2>🔥 SALE CỰC KHỦNG 🔥</h2>
                <p>Đừng bỏ lỡ cơ hội, mua sắm ngay hôm nay!</p>
            </div>
        </div>

        <div class="carousel-item">
            <img src="https://tce.net.vn/wp-content/uploads/2025/09/Tach-nen_-xe-tron-1-2024-550x330.png" class="d-block w-100" style="height:420px;object-fit:cover;" />
            <div class="carousel-caption d-none d-md-block" style="background: rgba(0, 0, 0, 0.4); border-radius: 10px; padding: 15px;">
                <h2>GIẢM GIÁ LÊN ĐẾN 50%</h2>
                <p>Áp dụng cho tất cả sản phẩm trong danh mục.</p>
            </div>
        </div>

        <div class="carousel-item">
            <img src="https://ximangxuanthanh.vn//upload/tin-bai/3-nhan-xi-mang-pooclang-hon-hop-pcb40.png" class="d-block w-100" style="height:420px;object-fit:cover;" />
            <div class="carousel-caption d-none d-md-block" style="background: rgba(0, 0, 0, 0.4); border-radius: 10px; padding: 15px;">
                <h2>MIỄN PHÍ VẬN CHUYỂN</h2>
                <p>Cho mọi đơn hàng từ 200.000 VNĐ.</p>
            </div>
        </div>

    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#bannerCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#bannerCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
    </button>
</div>

<div class="search-bar-container">
    @using (Html.BeginForm("Index", "Home", FormMethod.Get))
    {
        <div class="search-bar">
            <input type="text"
                   name="search"
                   placeholder="Bạn tìm gì hôm nay?"
                   value="@ViewBag.Search" />

            <button type="submit" class="search-btn">Tìm kiếm</button>
        </div>
    }
</div>



<div class="section-container">
    <h3 class="section-title">🏷️ Danh Mục Nổi Bật</h3>
    <div class="category-grid">
        @foreach (var c in ViewBag.Categories as List<_24DH113309_MyStore.Models.Category>)
        {
            string iconUrl = "https://cdn-icons-png.flaticon.com/512/2965/2965332.png"; // Icon mặc định

            if (c.CategoryName.ToLower().Contains("bảo hộ"))
            {
                iconUrl = "https://baoholaodong.dongphuctanbinh.com/wp-content/uploads/2023/04/icon-ao-phan-quang-min.png"; // Mũ bảo hộ
            }
            else if (c.CategoryName.ToLower().Contains("dụng cụ"))
            {
                iconUrl = "https://static.vecteezy.com/system/resources/previews/030/760/898/non_2x/construction-tool-trowel-2d-linear-cartoon-object-spatula-plastering-horticulture-equipment-isolated-line-item-white-background-gardening-manual-masonry-tool-color-flat-spot-illustration-vector.jpg"; // Dụng cụ
            }
            else if (c.CategoryName.ToLower().Contains("vật liệu"))
            {
                iconUrl = "https://streetvibe.vn/wp-content/uploads/2020/09/supreme-brick-0.jpg"; // Gạch (Vật liệu)
            }
            else if (c.CategoryName.ToLower().Contains("phương tiện"))
            {
                iconUrl = "https://cdn-icons-png.flaticon.com/512/3202/3202926.png"; // Xe tải (Phương tiện)
            }

            <a href="@Url.Action("Index", new { categoryId = c.CategoryID })"
               class="category-item-tiki @(ViewBag.SelectedCategory == c.CategoryID ? "active" : "")">

                <img src="@iconUrl" /> <span>@c.CategoryName</span>
            </a>
        }
    </div>
</div>

<div class="section-container">
    <h3 class="section-title text-danger">⚡ Flash Sale</h3>
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-3">
        @foreach (var p in Model.OrderBy(x => Guid.NewGuid()).Take(4))
        {
            <div class="col">
                <a href="@Url.Action("ProductDetail", "Home", new { id = p.ProductID })" class="product-card-tiki">
                    <div class="product-tag">SALE -0%</div>
                    <img src="@p.ProductImage" class="product-image" onerror="this.src='/Content/img/no-image.png'" />
                    <div class="product-info">
                        <div class="product-name">@p.ProductName</div>
                        <div class="product-price">
                            @String.Format("{0:N0}", p.ProductPrice * 1.0m) VNĐ
                            <span class="product-price-old">@String.Format("{0:N0}", p.ProductPrice) VNĐ</span>
                        </div>
                    </div>
                </a>
            </div>
        }
    </div>
</div>

<div class="section-container">
    <h3 class="section-title">✨ Gợi Ý Cho Bạn</h3>

    <div class="row row-cols-1 row-cols-md-3 row-cols-lg-5 g-3">
        @foreach (var p in Model)
        {
            <div class="col">
                <a href="@Url.Action("ProductDetail", "Home", new { id = p.ProductID })" class="product-card-tiki">
                    <img src="@p.ProductImage" class="product-image" onerror="this.src='/Content/img/no-image.png'" />
                    <div class="product-info">
                        <div class="product-name">@p.ProductName</div>
                        <div class="product-price">
                            @String.Format("{0:N0}", p.ProductPrice) VNĐ
                        </div>
                    </div>
                </a>
            </div>
        }
    </div>

    <div class="pagination-container">
        @Html.PagedListPager(
                                Model,
                                page => Url.Action("Index", new
                                {
                                    page,
                                    categoryId = ViewBag.SelectedCategory,
                                    search = ViewBag.Search
                                }),
                                new PagedListRenderOptions
                                {
                                    UlElementClasses = new[] { "pagination" },
                                    LiElementClasses = new[] { "page-item" },
                                    // Tùy chỉnh class cho link <a>
                                    FunctionToTransformEachPageLink = (liTagBuilder, linkTagBuilder) =>
                                    {
                                        linkTagBuilder.AddCssClass("page-link");

                                        int pageNumber = 1;
                                        string href = "";
                                        linkTagBuilder.Attributes.TryGetValue("href", out href);

                                        if (!string.IsNullOrEmpty(href) && href.Contains("page="))
                                        {
                                            var query = System.Web.HttpUtility.ParseQueryString(href.Split('?')[1]);
                                            int.TryParse(query["page"], out pageNumber);
                                        }

                                        if (pageNumber == Model.PageNumber)
                                        {
                                            liTagBuilder.AddCssClass("active");
                                        }
                                        return liTagBuilder;
                                    }
                                }
                            )
    </div>

</div>